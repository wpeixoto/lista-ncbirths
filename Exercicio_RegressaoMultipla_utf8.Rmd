---
title: "Métodos Inferenciais Avançados"
author: "William Peixoto"
output: 
  html_document:
    toc: True
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##  Regressão Múltipla

Carregue a base de dados **NCBirths**, disponível em <https://vincentarelbundock.github.io/Rdatasets/datasets.html>. 

Desenvolva os itens a seguir aplicando técnicas gráficas e formais, e apresente resultados, explicações e considerações que julgar necessários.

Utilize o presente documento Markdown (referências em <http://rmarkdown.rstudio.com>, <https://bookdown.org/yihui/rmarkdown/>) para a inserção do código e geração de resultados.

### Estrutura e variáveis

a. Conheça a estrutura dos dados e explore as variáveis quantitativas e qualitativas. 

```{r Data Load}
# bloco de código - item a
library(readr)
# NCbirths <- read_csv("NCbirths.csv", col_types = cols(Marital = col_factor(levels = c("1", 
#     "2")), Plural = col_factor(levels = c("1", 
#     "2", "3")), Sex = col_factor(levels = c("1", 
#     "2")), Smoke = col_factor(levels = c("1", 
#     "2")), X1 = col_skip()))
# View(NCbirths)

NCbirths = read.csv("NCbirths.csv")
str(NCbirths)
summary(NCbirths)
```

#### Valores ausentes
Por inspeção visual, foi possível detectar valores ausentes nas colunas `Weeks`(1), `Smoke`(5) e `Gained`(40). Faremos avaliação de cada caso assim que der.

```{r Check NA}
col.sums = colSums(is.na(NCbirths))
col.sums[col.sums>0]  # Verificação programática de quais colunas têm NAs

NCbirths<- cbind(NCbirths, somaNulos = rowSums(is.na(NCbirths)))
NCB_NAs = NCbirths[NCbirths$somaNulos > 0,]

```

Parece preocupante a grande quantidade de ausências em `Gained`, que corresponde a `r col.sums["Gained"]/nrow(NCbirths)*100`% das linhas. A estratégia ideal depende da alavancagem desses registros.


#### Fatores

Segundo a [documentação](NCbirths.html) do DataSet, várias dessas colunas podem ser convertidas em fatores:

```{r}
# Fatorizar o que der
NCbirths$X <- NULL
NCbirths$Plural <- factor(NCbirths$Plural, levels=c(1,2,3), labels=c('Single', 'Twins', 'Triplets'))
NCbirths$Sex <- factor(NCbirths$Sex, levels=c(1,2), labels=c("M", "F"))
NCbirths$Marital <- factor(NCbirths$Marital, labels=c("Married", "Not Married"))
NCbirths$RaceMom <- factor(NCbirths$RaceMom, levels=c(1,2,3,4,5,7,8),  # There's no Hawaiian in this base
                           labels=c(
                             "White",
                             "Black",
                             "AmericanIndian",
                             "Chinese",
                             "Japanese",
                             # "Hawaiian",
                             "Filipino",
                             "OtherAsianOrPacific"
                           ))
# TODO: Check race assignments

NCbirths$Smoke <- factor(NCbirths$Smoke, labels = c('N', 'Y'))  # Cuidado com os NAs
NCbirths$HispMom <- factor(NCbirths$HispMom)
NCbirths$Premie <- factor(NCbirths$Premie, labels=c("N", "Y"))
NCbirths$Low <- factor(NCbirths$Low, labels=c("N", "Y"))

```

### b.	Faça análises marginais e multivariadas.

Possíveis variáveis dependentes:

- `Plural`: Categórica, pode ser uma logística por Single/Not single
- `Gained`: Contínua
- Tempo de gestação:
    - `Weeks`: Discreta
    - `Premie`: Categórica, depende de `Weeks`
- Peso do bebê:
    - `BirthWeightOz` ou `BirthWeightGm`, numéricas. Em Oz, parece ser apenas inteiro enquanto em g, é float.
        - Se a conversão estiver correta, basta eliminar uma das colunas. Mas estou curioso para ver se o modelo linear vai mostrar alguma diferença inexistente.
  - `Low`: Categórica. Adequada para logística

Prováveis Correlações:

- A mais gritante é a do peso dos bebês, a mesma informação em duas unidades.
- `MomRace`, `HispMom` e `MomRace` (ô povo racista!): Há grande sobreposição entre os conceitos.
    - TODO: Verificar a sobreposição; tentar converter em uma única coluna
- `Weeks` e `Premie`: A segunda depende completamente da primeira
- `BirthWeight{Oz,Gm}` e `Low`: Mesmo caso: A segunda também depende completamente da primeira
    - TODO: Verificar se todos os `Low` realmente têm peso menor que 2500g

```{r}
# bloco de código - item b

summary(NCbirths$BirthWeightGm/NCbirths$BirthWeightOz)
if (mean(NCbirths$BirthWeightGm/NCbirths$BirthWeightOz)/max(NCbirths$BirthWeightGm/NCbirths$BirthWeightOz) != 1 ) {
  error("Há um erro de conversão entre Oz e g")
} else {
  if (max(NCbirths$BirthWeightGm/NCbirths$BirthWeightOz) == 28.35)  {
    print("Todas as conversões de unidade estão corretas")
  } else {
    print("Embora consistentes, as conversões não estão corretas")
  }
}


```

### c.	Verifique as premissas do modelo linear.

```{r}
# bloco de código - item c



```

### d.	Com base nas análises, proponha um ou mais modelos lineares multivariados. Explique a sua escolha.

```{r}
# bloco de código - item d



```

e.	Utilize o(s) modelo(s) proposto(s) para fazer pelo menos uma predição.

```{r}
# bloco de código - item e



```

## ENTREGA EM 31/10/2018, ÀS 23h59.


